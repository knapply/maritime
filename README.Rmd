---
title: "`{maritime}` ‚öì üö¢ ‚õµ üõ•Ô∏è"
output:
  github_document:
    html_preview: true
    toc: true
    toc_depth: 2
  html_document:
    keep_md: yes
always_allow_html: yes
editor_options: 
  chunk_output_type: console
---

<!-- README.Rmd generates README.md. -->

```{r, echo=FALSE}
knitr::opts_chunk$set(
  # collapse = TRUE,
  fig.align = "center",
  comment = "#>",
  fig.path = "man/figures/",
  message = FALSE,
  warning = FALSE
)
options(width = 150)
```


<!-- badges: start -->
[![R build status](https://github.com/knapply/maritime/workflows/R-CMD-check/badge.svg)](https://github.com/knapply/maritime/actions?workflow=R-CMD-check)
[![AppVeyor build status](https://ci.appveyor.com/api/projects/status/github/knapply/maritime?branch=master&svg=true)](https://ci.appveyor.com/project/knapply/maritime)
[![Travis-CI Build Status](https://travis-ci.org/knapply/maritime.svg?branch=master)](https://travis-ci.org/knapply/maritime)
[![Codecov test coverage](https://codecov.io/gh/knapply/maritime/branch/master/graph/badge.svg)](https://codecov.io/gh/knapply/maritime?branch=master)
[![Lifecycle](https://img.shields.io/badge/lifecycle-experimental-orange.svg)](https://www.tidyverse.org/lifecycle/#experimental)
[![GitHub last commit](https://img.shields.io/github/last-commit/knapply/maritime.svg)](https://github.com/knapply/maritime/commits/master)
[![License: GPL v3](https://img.shields.io/badge/License-GPLv3-blue.svg)](https://www.gnu.org/licenses/gpl-3.0)
[![Depends](https://img.shields.io/badge/Depends-GNU_R>=3.6-blue.svg)](https://www.r-project.org/)
[![GitHub code size in bytes](https://img.shields.io/github/languages/code-size/knapply/maritime.svg)](https://github.com/knapply/maritime)
[![Gitter](https://badges.gitter.im/maritime/community.svg)](https://gitter.im/maritime/community?utm_source=badge&utm_medium=badge&utm_campaign=pr-badge)
[![HitCount](http://hits.dwyl.io/knapply/maritime.svg)](http://hits.dwyl.io/knapply/maritime)
<!-- [![CRAN status](https://www.r-pkg.org/badges/version/maritime)](https://cran.r-project.org/package=maritime) -->
<!-- badges: end -->

# Introduction

`{maritime}` is a toolkit for maritime data.

Initial focus is _performant_ and correct AIS decoding routines for R by building on [Kurt Schwehr](https://twitter.com/kurtschwehr)'s [__libais__](https://github.com/schwehr/libais).


# Installation

You'll need a C++ compiler. If you're using Windows, that means [Rtools](https://cran.r-project.org/bin/windows/Rtools/).

```{r, eval=FALSE}
if (!requireNamespace("remotes", quietly = TRUE)) install.packages("remotes")
remotes::install_github("knapply/maritime")
```

# Usage


```{r}
library(maritime)
```


# AIS

## Status

What's implemented so far?

* _Fast_ preprocessing and line normalization.
  + Multi-line messages are reconciled and merged _automatically_.
* Message Types:
  + `ais_msgs$msg_1_2_3`
  + `ais_msgs$msg_4_11`
  + `ais_msgs$msg_5`
  + `ais_msgs$msg_7_13`
  + `ais_msgs$msg_9`
  + `ais_msgs$msg_10`
  
  

```{r}
nmea_file <- "inst/example-data/big-files/20181210.log"
paste(round(file.size(nmea_file) / 1e9, 2L), "GB")
readLines(nmea_file, n = 10) # quick peak at the data
```


```{r}
ais_decode_filter(msgs = nmea_file, msg_type = ais_msgs$msg_1_2_3)
```


```{r}
ais_decode_filter(msgs = nmea_file, msg_type = ais_msgs$msg_5)
```

## Performance


```{r}
bench_mark <- bench::mark(
  file = decoded <- ais_decode_list(nmea_file, as_tibble = FALSE, verbose = FALSE),
  iterations = 1,
  check = FALSE
)

bench_mark
lapply(decoded, tibble::as_tibble)
```


## Future


```{r}
ptr_df <- tibble::as_tibble(
  maritime:::.nest_test(nmea_file)
)
ptr_df
```

The `msg` column contains external pointers to decoded __libais__ objects.

```{r}
tibble::as_tibble(
  do.call(
    rbind,
    lapply(ptr_df[ptr_df$message_id == 1, ]$msg[1:10], 
           maritime:::.ais_unwrap_msg)
    )
)
```


### Inspection Tools

```{r}
tibble::as_tibble(
  maritime:::.nmea_df(nmea_file, n_max = -1)
)
```



# Credits

* AIS decoding routines are built on top of [Kurt Schwehr](https://twitter.com/kurtschwehr)'s [__libais__](https://github.com/schwehr/libais).


