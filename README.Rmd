---
title: "`{maritime}` ‚öì üö¢ ‚õµ üõ•Ô∏è"
output:
  github_document:
    html_preview: true
    toc: true
    toc_depth: 2
  html_document:
    keep_md: yes
always_allow_html: yes
editor_options: 
  chunk_output_type: console
---

<!-- README.Rmd generates README.md. -->

```{r, echo=FALSE}
knitr::opts_chunk$set(
  # collapse = TRUE,
  fig.align = "center",
  comment = "#>",
  fig.path = "man/figures/",
  message = FALSE,
  warning = FALSE
)
options(width = 150)
```


<!-- badges: start -->
[![R build status](https://github.com/knapply/maritime/workflows/R-CMD-check/badge.svg)](https://github.com/knapply/maritime/actions?workflow=R-CMD-check)
[![AppVeyor build status](https://ci.appveyor.com/api/projects/status/github/knapply/maritime?branch=master&svg=true)](https://ci.appveyor.com/project/knapply/maritime)
[![Travis-CI Build Status](https://travis-ci.org/knapply/maritime.svg?branch=master)](https://travis-ci.org/knapply/maritime)
[![Codecov test coverage](https://codecov.io/gh/knapply/maritime/branch/master/graph/badge.svg)](https://codecov.io/gh/knapply/maritime?branch=master)
[![Lifecycle](https://img.shields.io/badge/lifecycle-experimental-orange.svg)](https://www.tidyverse.org/lifecycle/#experimental)
[![GitHub last commit](https://img.shields.io/github/last-commit/knapply/maritime.svg)](https://github.com/knapply/maritime/commits/master)
[![License: GPL v3](https://img.shields.io/badge/License-GPLv3-blue.svg)](https://www.gnu.org/licenses/gpl-3.0)
[![Depends](https://img.shields.io/badge/Depends-GNU_R>=3.6-blue.svg)](https://www.r-project.org/)
[![GitHub code size in bytes](https://img.shields.io/github/languages/code-size/knapply/maritime.svg)](https://github.com/knapply/maritime)
[![Gitter](https://badges.gitter.im/maritime/community.svg)](https://gitter.im/maritime/community?utm_source=badge&utm_medium=badge&utm_campaign=pr-badge)
[![HitCount](http://hits.dwyl.io/knapply/maritime.svg)](http://hits.dwyl.io/knapply/maritime)
<!-- [![CRAN status](https://www.r-pkg.org/badges/version/maritime)](https://cran.r-project.org/package=maritime) -->
<!-- badges: end -->

# Introduction

# Installation

You'll need a C++ compiler. If you're using Windows, that means [Rtools](https://cran.r-project.org/bin/windows/Rtools/).

```{r, eval=FALSE}
if (!requireNamespace("remotes", quietly = TRUE)) install.packages("remotes")
remotes::install_github("knapply/maritime")
```


# Usage

```{r}
library(maritime)
```


# Performance

```{r}
nmea_file <- "inst/example-data/big-files/20181210.log"
paste(round(file.size(nmea_file) / 1e9, 2L), "GB")
```

```{r}
options(maritime_verbose = FALSE)

library(sf)
library(tibble)

warm_ups <- bench::mark(
  warm_up1 = maritime:::.ais_decode_filter_file_impl(nmea_file, msg_type = ais_msgs$msg_1_2_3, as_sf = FALSE, as_tibble = FALSE, verbose = FALSE),
  warm_up2 = maritime:::.ais_decode_filter_file_impl(nmea_file, msg_type = ais_msgs$msg_1_2_3, as_sf = FALSE, as_tibble = FALSE, verbose = FALSE)
  ,
  iterations = 1,
  check = FALSE
)

bench_marks <- bench::mark(
  `plain data.frame` = ais_df <- ais_decode_filter(nmea_file, as_sf = FALSE, as_tibble = FALSE),
  `sf data.frame` = ais_sf_df <- ais_decode_filter(nmea_file, as_tibble = FALSE),
  `tibble` = ais_tbl <- ais_decode_filter(nmea_file, as_sf = FALSE),
  `sf tibble` = ais_sf_tbl <- ais_decode_filter(nmea_file)
  ,
  `tibble::as_tibble()` = as_tibble(ais_decode_filter(nmea_file, as_sf = FALSE, as_tibble = FALSE)),
  `sf::st_as_sf(tibble::as_tibble())` = st_as_sf(as_tibble(ais_decode_filter(nmea_file, as_sf = FALSE, as_tibble = FALSE)), coords = c("lng_deg", "lat_deg"), crs = 4326L),
  `sf::st_as_sf()` = st_as_sf(ais_decode_filter(nmea_file, as_sf = FALSE, as_tibble = FALSE), coords = c("lng_deg", "lat_deg"), crs = 4326L)
  ,
  iterations = 1,
  check = FALSE,
  filter_gc = FALSE
)

rbind(warm_ups, bench_marks)
```

```{r}
ais_sf_tbl
```


```{r, eval=FALSE, echo=FALSE}
# library(maritime)
files <- dir("inst/example-data/big-files/", full.names = TRUE)
# lines1 <- readr::read_lines(files[[1]])
all_lines <- c(readr::read_lines(files[[1]]), readr::read_lines(files[[2]]))
# cumsum(nchar(lines1))
# lines2 <- readr::read_lines(files[[2]])
# all_lines <- c(lines1, lines2)
# max(nchar(all_lines))
# range(nchar(all_lines))
# hist(nchar(all_lines))
# 
# 
# files <- rep(files, 3)
# length(files)
# paste(round(sum(file.size(files)) / 1e9, 2L), "GB")

test <- .ais_stream_test(files)
scales::comma(length(test))
bench_mark <- bench::mark(
  file = decoded <- ais_decode_filter(
    files, 
    as_tibble = FALSE, as_sf = FALSE, verbose = FALSE
  ),
  iterations = 1,
  check = FALSE
)

bench_mark
tibble::as_tibble(decoded)
```


# Credits

* AIS decoding routines are built on top of [Kurt Schwehr](https://twitter.com/kurtschwehr)'s [__libais__](https://github.com/schwehr/libais).



# Dev Notes

Message 5, single line

```
!BSVDM,2,1,9,A,53KPtl01pv8`tTtR22050thhtr2222222222220l1`A916Vh0;20DPSmD`0D,0*21
```

more message 5s

```
!AIVDM,2,1,0,A,58wt8Ui`g??r21`7S=:22058<v05Htp000000015>8OA;0sk,0*7B 
!AIVDM,2,2,0,A,eQ8823mDm3kP00000000000,2*5D

# nchar("58wt8Ui`g??r21`7S=:22058<v05Htp000000015>8OA;0skeQ8823mDm3kP00000000000")
# 71
```

$$C_c(i,G)=\frac{1}{n}\sum_{j \neq i} \frac{1}{d(i, j)}$$
CC(i, G) =
1
N
√ï
j,i
1
d(i, j)
,
$$
